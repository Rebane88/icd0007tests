#!/usr/bin/env php
<?php

$opts = getopt('t:f:', ['teamcity:', 'filter:']);
$testPath = $opts['teamcity'] ?? null;
$filter = $opts['filter'] ?? '';
$testName = getSelectedTestName($filter);

$cmd = sprintf("php %s --testToRun '%s'", $testPath, $testName);

exec($cmd, $output, $exitCode);

print join(PHP_EOL, $output);

function getSelectedTestName(string $filter): string {
    $str = str_replace('\\s', ' ', $filter);
    $str = preg_replace('/.*::/', '', $str);
    return preg_replace('/\(.*/', '', $str);
}